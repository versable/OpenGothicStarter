#!/usr/bin/env bash
set -euo pipefail

mapfile -t files < <(
  git diff --cached --name-only --diff-filter=ACMR |
    grep -E '\.(c|cc|cpp|cxx|h|hh|hpp|hxx)$' || true
)

mapfile -t po_files < <(
  git diff --cached --name-only --diff-filter=ACMR |
    grep -E '^i18n/.+\.po$' || true
)

if [ "${#files[@]}" -gt 0 ]; then
  ./scripts/format.sh "${files[@]}"
  git add "${files[@]}"

  echo "Formatted staged C/C++ files with clang-format."
fi

if [ "${#po_files[@]}" -gt 0 ]; then
  ./scripts/check_i18n.sh "${po_files[@]}"
fi
